(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();const y=window.location.hostname==="localhost"?"http://localhost:3000":window.location.origin,C=5e3,$=36e4;let a=null,p="free",d=null,w=[],c=null,I=null;document.addEventListener("DOMContentLoaded",()=>{S(),P()});function P(){const t=document.getElementById("promptInput");t&&t.addEventListener("input",e=>{const n=document.getElementById("charCount");n&&(n.textContent=e.target.value.length)})}async function S(){try{const t=x(),n=await(await fetch(`${y}/api/user`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({deviceId:t})})).json();n.success&&n.user?(a=n.user,L(),await v()):l("Failed to initialize. Please refresh.")}catch(t){console.error("Init error:",t),l("Connection failed. Check your internet.")}}function x(){let t=localStorage.getItem("neoclip_device_id");return t||(t=`device-${Date.now()}-${Math.random().toString(36).slice(2)}`,localStorage.setItem("neoclip_device_id",t)),t}function L(){if(!a)return;const t=10-(a.free_used||0),e=a.resets_at?new Date(a.resets_at):new Date,o=Math.max(0,Math.ceil((e-new Date)/(1e3*60*60*24))),r=document.getElementById("freeRemaining"),i=document.getElementById("daysUntilReset");r&&(r.textContent=Math.max(0,t)),i&&(i.textContent=o)}function V(t){p=t,document.querySelectorAll(".tier-button").forEach(n=>{n.classList.remove("active"),n.dataset.tier===t&&n.classList.add("active")});const e=document.getElementById("buttonText");e&&(e.textContent=t==="free"?"üöÄ Generate 10s FREE Video":"‚≠ê Generate 30s HD Video (Pro)")}async function _(){const t=document.getElementById("promptInput"),e=t?t.value.trim():"";if(!e){l("Please enter a prompt");return}if(!a){l("Not initialized. Refresh page.");return}u(),O("Starting video generation...");try{const n=await fetch(`${y}/api/generate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e,userId:a.id,tier:p,length:p==="free"?10:30})}),o=await n.json();if(!n.ok){if(n.status===402){l(o.message||"Free limit reached. Upgrade to Pro!"),setTimeout(()=>M(),2e3);return}throw new Error(o.error||o.message||"Generation failed")}if(!o.success||!o.generationId)throw new Error(o.error||"Invalid response");console.log("Generation started:",o),o.remainingFree!==null&&(a.free_used=10-o.remainingFree,L()),h(`Generating with ${o.providerName||"AI"}...`,15),g("‚è±Ô∏è Video generation takes 3-5 minutes. Please wait..."),I=Date.now(),F(o.generationId,o.needsAd)}catch(n){console.error("Generation error:",n),l(n.message||"Failed to start generation"),m()}}function F(t,e){console.log(`Starting poll for ${t}`);const n=async()=>{const o=Date.now()-I;if(o>$){u(),l("Generation timed out after 6 minutes. Please try again."),m();return}try{const i=await(await fetch(`${y}/api/poll?generationId=${t}`)).json();console.log("Poll response:",i);const s=i.progress||Math.min(20+Math.floor(o/1e4)*5,90);if(h(i.message||`Generating... ${s}%`,s),i.status==="completed"&&i.videoUrl){u(),h("Video ready!",100),d=i.videoUrl,E(i.videoUrl,e),await v(),m(),g("‚úÖ Video generated successfully!");return}if(i.status==="failed"){u(),l(i.error||"Generation failed"),m(),await v();return}c=setTimeout(n,C)}catch(r){console.error("Poll error:",r),c=setTimeout(n,C)}};n()}function u(){c&&(clearTimeout(c),c=null),I=null}function O(t){const e=document.getElementById("generateButton"),n=document.getElementById("loadingIndicator"),o=document.getElementById("loadingText"),r=document.getElementById("progressBar"),i=document.getElementById("progressFill"),s=document.getElementById("errorContainer"),B=document.getElementById("videoContainer");e&&(e.disabled=!0),n&&n.classList.remove("hidden"),o&&(o.textContent=t),r&&r.classList.remove("hidden"),i&&(i.style.width="5%"),s&&s.classList.add("hidden"),B&&B.classList.add("hidden")}function h(t,e){const n=document.getElementById("loadingText"),o=document.getElementById("progressFill");n&&(n.textContent=t),o&&(o.style.width=`${Math.min(e,99)}%`)}function m(){const t=document.getElementById("generateButton"),e=document.getElementById("loadingIndicator"),n=document.getElementById("progressBar");t&&(t.disabled=!1),e&&e.classList.add("hidden"),n&&n.classList.add("hidden")}function E(t,e=!1){const n=document.getElementById("videoContainer"),o=document.getElementById("videoPlayer"),r=document.getElementById("adBanner");o&&(o.src=t,o.load()),n&&n.classList.remove("hidden"),r&&(e||p==="free"?r.classList.remove("hidden"):r.classList.add("hidden")),n&&n.scrollIntoView({behavior:"smooth",block:"center"})}async function v(){if(a)try{const e=await(await fetch(`${y}/api/status?userId=${a.id}`)).json();e.success&&(e.generations&&(w=e.generations,A()),e.user&&(a.free_used=e.user.freeUsed,a.resets_at=e.user.resetsAt,L()))}catch(t){console.error("Failed to load generations:",t)}}function A(){const t=document.getElementById("historyContainer"),e=document.getElementById("historyList");if(!t||!e)return;const n=w.filter(o=>o.status==="completed"&&o.videoUrl);if(n.length===0){t.classList.add("hidden");return}t.classList.remove("hidden"),e.innerHTML="",n.slice(0,10).forEach(o=>{const r=document.createElement("div");r.className="history-item",r.innerHTML=`
            <div class="history-prompt">${f(o.prompt||"Untitled")}</div>
            <div class="history-meta">
                <span class="history-tier">${o.tier==="free"?"üé¨ Free":"‚≠ê Pro"}</span>
                <span class="history-time">${U(o.createdAt)}</span>
            </div>
        `,r.addEventListener("click",()=>{o.videoUrl&&(d=o.videoUrl,E(o.videoUrl,o.tier==="free"))}),e.appendChild(r)})}function T(){const t=w.filter(n=>n.status==="completed"&&n.videoUrl);if(t.length===0){g("No videos yet. Generate your first video!");return}let e=document.getElementById("libraryOverlay");e||(e=document.createElement("div"),e.id="libraryOverlay",e.className="library-overlay",document.body.appendChild(e)),e.innerHTML=`
        <div class="library-content">
            <div class="library-header">
                <h2>üìö Your Video Library</h2>
                <button class="close-btn" onclick="closeLibrary()">‚úï</button>
            </div>
            <div class="library-grid">
                ${t.map(n=>`
                    <div class="library-item" onclick="playFromLibrary('${f(n.videoUrl)}', '${n.tier}')">
                        <div class="library-preview">
                            <video src="${f(n.videoUrl)}" muted></video>
                            <div class="play-icon">‚ñ∂</div>
                        </div>
                        <div class="library-info">
                            <p class="library-prompt">${f(n.prompt||"Untitled")}</p>
                            <span class="library-date">${U(n.createdAt)}</span>
                        </div>
                    </div>
                `).join("")}
            </div>
        </div>
    `,e.classList.add("visible")}function b(){const t=document.getElementById("libraryOverlay");t&&t.classList.remove("visible")}function D(t,e){b(),d=t,E(t,e==="free")}function U(t){if(!t)return"";try{const e=new Date(t),o=new Date-e,r=Math.floor(o/6e4);if(r<1)return"Just now";if(r<60)return`${r}m ago`;const i=Math.floor(r/60);if(i<24)return`${i}h ago`;const s=Math.floor(i/24);return s<7?`${s}d ago`:e.toLocaleDateString()}catch{return""}}function f(t){if(!t)return"";const e=document.createElement("div");return e.textContent=t,e.innerHTML}function N(){if(!d)return;const t=document.createElement("a");t.href=d,t.download=`neoclip-${Date.now()}.mp4`,t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t)}async function G(){if(!d)return;const t={title:"My NeoClip Video",text:"Created with NeoClip AI - Free AI video generator!",url:d};try{navigator.share?await navigator.share(t):(await navigator.clipboard.writeText(d),g("Video URL copied!"))}catch(e){console.error("Share failed:",e)}}function R(){const t=document.getElementById("promptInput"),e=document.getElementById("charCount"),n=document.getElementById("videoContainer"),o=document.getElementById("errorContainer");t&&(t.value=""),e&&(e.textContent="0"),n&&n.classList.add("hidden"),o&&o.classList.add("hidden"),d=null,u()}function M(){alert(`üåü Upgrade to Pro - Coming Soon!

‚úÖ 120 HD clips per month
‚úÖ 30-second max length
‚úÖ 1080p quality
‚úÖ No ads
‚úÖ Priority processing

Only $4.99/month`)}function l(t){const e=document.getElementById("errorContainer"),n=document.getElementById("errorMessage");n&&(n.textContent=t),e&&e.classList.remove("hidden"),setTimeout(()=>{e&&e.classList.add("hidden")},8e3)}function g(t){let e=document.getElementById("toast");e||(e=document.createElement("div"),e.id="toast",e.className="toast",document.body.appendChild(e)),e.textContent=t,e.classList.add("visible"),setTimeout(()=>{e.classList.remove("visible")},3e3)}function H(t){var e,n;document.querySelectorAll(".nav-btn").forEach(o=>{o.classList.remove("active")}),t==="home"?((e=document.querySelector('.nav-btn[onclick*="home"]'))==null||e.classList.add("active"),b()):t==="library"&&((n=document.querySelector('.nav-btn[onclick*="Library"]'))==null||n.classList.add("active"),T())}window.selectTier=V;window.generateVideo=_;window.downloadVideo=N;window.shareVideo=G;window.resetUI=R;window.handleUpgrade=M;window.showLibrary=T;window.closeLibrary=b;window.playFromLibrary=D;window.showScreen=H;
